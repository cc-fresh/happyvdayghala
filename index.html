<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For Ghala ‚ù§Ô∏è</title>
  <style>
    body{
      margin:0;
      font-family:"Segoe UI",Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(135deg,#7c3aed,#ec4899);
      color:#fff;
      text-align:center;
      overflow-x:hidden;
    }

    .section{ padding:60px 20px; max-width:880px; margin:auto; }
    h1,h2{ margin:0 0 20px; }

    .heart{
      font-size:60px;
      animation:pulse 1.2s infinite;
      cursor:pointer;
      user-select:none;
    }

    @keyframes pulse{
      0%{ transform:scale(1); }
      50%{ transform:scale(1.2); }
      100%{ transform:scale(1); }
    }

    button{
      padding:12px 24px;
      font-size:18px;
      border:none;
      border-radius:12px;
      cursor:pointer;
      margin:10px;
      transition:0.2s ease;
    }

    #yesBtn{ background:#ec4899; color:#fff; }
    #noBtn{ background:#fff; color:#7c3aed; position:relative; }
    #musicBtn{
      background:rgba(255,255,255,0.18);
      color:#fff;
      border:1px solid rgba(255,255,255,0.35);
    }

    .hidden{ display:none; }

    .card{
      background:rgba(255,255,255,0.12);
      border-radius:20px;
      padding:25px;
      margin:20px 0;
      backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.22);
      text-align:left;
      line-height:1.6;
    }

    .photo-bubbles{
      display:flex;
      gap:14px;
      justify-content:center;
      flex-wrap:wrap;
      margin:28px auto 0;
    }

    .bubble{
      width:84px;
      height:84px;
      border-radius:50%;
      overflow:hidden;
      border:3px solid rgba(255,255,255,0.75);
      box-shadow:0 10px 25px rgba(0,0,0,0.18);
      cursor:pointer;
      transition:transform 0.25s ease, box-shadow 0.25s ease;
    }

    .bubble:hover{
      transform:scale(1.08);
      box-shadow:0 14px 30px rgba(0,0,0,0.25);
    }

    .bubble img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* Enlarged photo popup */
    .photo-popup{
      position:fixed;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(0,0,0,0.5);
      backdrop-filter:blur(6px);
      opacity:0;
      pointer-events:none;
      transition:opacity 0.25s ease;
      z-index:999;
      padding:18px;
      box-sizing:border-box;
    }

    .photo-popup.active{ opacity:1; pointer-events:all; }

    .popup-card{
      width:min(380px,88vw);
      background:rgba(255,255,255,0.12);
      border:1px solid rgba(255,255,255,0.22);
      border-radius:22px;
      padding:14px;
      box-shadow:0 20px 60px rgba(0,0,0,0.4);
      animation:popIn 0.25s ease;
    }

    .popup-card img{ width:100%; border-radius:16px; display:block; }

    .popup-caption{ margin-top:10px; opacity:0.95; font-weight:700; }

    @keyframes popIn{
      from{ transform:scale(0.86); opacity:0; }
      to{ transform:scale(1); opacity:1; }
    }

    /* --- Garden builder (basket) --- */
    .garden-wrap{
      margin:24px auto 0;
      max-width:820px;
      background:rgba(255,255,255,0.14);
      border-radius:22px;
      padding:18px;
      backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.22);
      box-shadow:0 12px 30px rgba(0,0,0,0.18);
      text-align:left;
    }

    .garden-grid{ display:grid; grid-template-columns:1fr; gap:14px; }

    .garden-controls{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px;
      align-items:end;
    }

    .field{
      background:rgba(255,255,255,0.12);
      border:1px solid rgba(255,255,255,0.22);
      border-radius:16px;
      padding:12px;
    }

    .field label{ display:block; font-weight:800; margin-bottom:8px; opacity:0.95; }

    .field select,
    .field input[type="color"],
    .field input[type="number"],
    .field input[type="range"]{
      width:100%;
      box-sizing:border-box;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.28);
      background:rgba(0,0,0,0.12);
      color:#fff;
      padding:10px;
      outline:none;
    }

    .garden-actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:10px;
    }
    .garden-actions button{ margin:0; }

    .pill-mini{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,0.16);
      border:1px solid rgba(255,255,255,0.22);
      font-weight:800;
      margin:6px 8px 0 0;
    }

    .dot{
      width:14px; height:14px; border-radius:999px;
      border:1px solid rgba(255,255,255,0.45);
      box-shadow:0 6px 14px rgba(0,0,0,0.2);
    }

    .xbtn{
      background:rgba(0,0,0,0.18);
      color:#fff;
      border:1px solid rgba(255,255,255,0.22);
      border-radius:999px;
      width:26px; height:26px;
      display:inline-grid;
      place-items:center;
      padding:0;
      cursor:pointer;
    }

    #gardenCanvas{
      position:relative;
      height:380px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.25);
      background:
        radial-gradient(1200px 480px at 50% 30%, rgba(255,255,255,0.18), rgba(255,255,255,0.02)),
        linear-gradient(180deg, rgba(80,200,120,0.20), rgba(0,0,0,0.10));
    }

    .garden-hint{ margin-top:10px; opacity:0.9; font-size:14px; line-height:1.45; }

    .flower{
      position:absolute;
      width:64px; height:64px;
      transform:translate(-50%,-50%);
      user-select:none;
      pointer-events:none;
      filter:drop-shadow(0 10px 14px rgba(0,0,0,0.25));
    }
    .flower svg{ width:100%; height:100%; display:block; }

    @media (max-width:720px){
      .garden-controls{ grid-template-columns:1fr; }
      #gardenCanvas{ height:340px; }
    }

    /* --- Mini game --- */
    .game-wrap{
      margin:24px auto 0;
      max-width:560px;
      background:rgba(255,255,255,0.14);
      border-radius:22px;
      padding:18px;
      backdrop-filter:blur(10px);
      border:1px solid rgba(255,255,255,0.22);
      box-shadow:0 12px 30px rgba(0,0,0,0.18);
    }

    .game-top{
      display:flex;
      justify-content:space-between;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:12px;
      align-items:center;
    }

    .pill{
      padding:10px 14px;
      border-radius:999px;
      background:rgba(255,255,255,0.18);
      border:1px solid rgba(255,255,255,0.22);
      font-weight:700;
    }

    #startGameBtn{
      background:rgba(255,255,255,0.2);
      color:#fff;
      border:1px solid rgba(255,255,255,0.35);
    }

    #gameArea{
      position:relative;
      width:100%;
      height:360px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,0.25);
      background:rgba(0,0,0,0.08);
      touch-action:manipulation;
      user-select:none;
    }

    .target{
      position:absolute;
      width:56px; height:56px;
      border-radius:50%;
      display:grid;
      place-items:center;
      font-size:26px;
      background:rgba(255,255,255,0.22);
      border:2px solid rgba(255,255,255,0.55);
      box-shadow:0 10px 18px rgba(0,0,0,0.18);
      cursor:pointer;
    }

    @media (max-width:520px){
      #gameArea{ height:320px; }
      .target{ width:52px; height:52px; font-size:24px; }
      .bubble{ width:76px; height:76px; }
    }

    /* debug badge (remove later) */
    .debug-badge{
      position:fixed;
      right:12px;
      bottom:12px;
      z-index:9999;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(0,0,0,0.28);
      border:1px solid rgba(255,255,255,0.22);
      font-weight:800;
      font-size:13px;
      backdrop-filter:blur(8px);
    }

    /* --- Loader mini-game (fast overlay) --- */
    .loader{
      position:fixed; inset:0;
      display:grid; place-items:center;
      background:linear-gradient(135deg,#7c3aed,#ec4899);
      z-index:99999;
    }
    .loader-card{
      width:min(420px,90vw);
      background:rgba(255,255,255,0.14);
      border:1px solid rgba(255,255,255,0.22);
      border-radius:22px;
      padding:22px;
      box-shadow:0 18px 55px rgba(0,0,0,0.35);
      backdrop-filter:blur(12px);
    }
    .loader-title{ font-size:22px; font-weight:900; margin-bottom:8px; }
    .loader-sub{ opacity:0.9; font-weight:700; }
    .loader-heart{
      font-size:60px;
      margin:14px 0;
      cursor:pointer;
      user-select:none;
      animation:pulse 1s infinite;
    }
    .loader.hide{
      opacity:0;
      pointer-events:none;
      transition:opacity 0.35s ease;
    }
  </style>
</head>
<body>

  <!-- Loader (shows instantly) -->
  <div id="loader" class="loader" aria-label="Loading">
    <div class="loader-card">
      <div class="loader-title">loading love‚Ä¶ üíú</div>
      <div class="loader-sub">tap the heart while it loads</div>
      <div id="loaderHeart" class="loader-heart">üíó</div>
      <div class="loader-sub">taps: <span id="tapCount">0</span></div>
    </div>
  </div>

  <div id="debugBadge" class="debug-badge">js: loading‚Ä¶</div>

  <!-- Intro -->
  <div class="section">
    <div class="heart" id="bigHeart" title="psst‚Ä¶ tap me 5 times">‚ù§Ô∏è</div>
    <h1>Hi Ghala</h1>
    <p>I KNOW UR MY VALENTINE ALREADY BUT PLS let me still do something special for you üò≠üíú</p>

    <div class="photo-bubbles" id="photoBubbles">
      <div class="bubble"><img loading="lazy" decoding="async" src="ghala1.jpg" alt="Ghala photo 1" data-caption="THIS FILTER SO CUTE ON Uüíú" /></div>
      <div class="bubble"><img loading="lazy" decoding="async" src="ghala2.jpg" alt="Ghala photo 2" data-caption="I LOVE UR DRAWINGS GOOPLA üò≠" /></div>
      <div class="bubble"><img loading="lazy" decoding="async" src="ghala3.jpg" alt="Ghala photo 3" data-caption="UR LITERALLY PERFECT" /></div>
    </div>

    <div style="margin-top:18px;">
      <button id="musicBtn">Play our song üé∂</button>
    </div>

    <!-- preload none so it doesn't slow initial load -->
    <audio id="bgMusic" src="song.mp3" loop preload="none"></audio>
  </div>

  <!-- Photo popup -->
  <div id="photoPopup" class="photo-popup" aria-hidden="true">
    <div class="popup-card" role="dialog" aria-label="Photo preview">
      <img id="popupImg" src="" alt="" />
      <div id="popupCaption" class="popup-caption"></div>
    </div>
  </div>

  <!-- Funny Question -->
  <div class="section">
    <h1>Will you keep being my Valentine?</h1>
    <button id="yesBtn">Yes ‚ù§Ô∏è</button>
    <button id="noBtn">No üò≠</button>
    <p id="answer" class="hidden">YAYAYAYYAAYYA üíûüíûüíû</p>
  </div>

  <!-- Story -->
  <div class="section">
    <h2>our story üíú</h2>

    <div class="card">
      <h3>the day we met</h3>
      <p>
        I wasn‚Äôt expecting us to fall in love with each other, but I always knew we had something special because we clicked instantly and were always comfortable with each other despite only speaking occasionally. Even when we didn‚Äôt talk nonstop, the comfort never left. That instant connection felt soooo unreal, something my heart recognized before my mind could explain it. From the beginning, it never felt forced. It was always so natursl occurring. And deep down, I knew we had something real that I could never experience ever again.
      </p>
    </div>

    <div class="card">
      <h3>the time i realized i were in love</h3>
      <p>
        The time I realized I had feelings for you was when I was lost and confused, doubting myself that I would never ever fall in love with someone again. Then you came along and rekindle my flame. I am so glad I met you and I don't ever regret falling in love with you. You reminded me that love can come back even after you think your heart is done trying. You brought warmth to a place in me that had been cold for a long timeand that changed everything.
      </p>
    </div>

    <div class="card">
      <h3>my hope for our future</h3>
      <p>
        I hope that we can be together because it has been truly a long ride, one I don't want to end nor do I want to sever the bond we have. I know we have disagreed, argued, and even attempted cutting each other many times. But I still believe we are capable of maturing and being the best we can for each other. I love you so much and I wish you know how much I love you because I fought so so so hard for you and gave you the most chances i ever given a person just so I can be with you.
      </p>
    </div>

    <div class="card">
      <h3>a letter from me to you</h3>
      <p>
        Your mesmerizing eyes drown me into a sea of butterflies. You were always and still are the most gorgeous woman I've set my eyes upon. I cherish your personality because you are always wanting to help others and never want anyone to suffer regardless of who they are. You have a beautiful soul and mindset that lightens my life always, and you guide me towards that light when im in the dark.
      </p>
    </div>
  </div>

  <!-- Garden Builder -->
  <div class="section">
    <h2>build a little garden üå∑</h2>
    <p>add flowers to your basket, then hit <b>grow garden</b> üíú</p>

    <div class="garden-wrap">
      <div class="garden-grid">

        <div class="garden-controls">
          <div class="field">
            <label for="basketFlowerType">flower type</label>
            <select id="basketFlowerType">
              <option value="daisy">daisy</option>
              <option value="tulip">tulip</option>
              <option value="rose">rose</option>
            </select>
          </div>

          <div class="field">
            <label for="basketFlowerColor">color</label>
            <input id="basketFlowerColor" type="color" value="#ff66cc" />
          </div>

          <div class="field">
            <label for="basketFlowerSize">size <span id="basketSizeReadout">64</span>px</label>
            <input id="basketFlowerSize" type="range" min="44" max="96" value="64" />
          </div>
        </div>

        <div class="garden-actions">
          <button id="addToBasketBtn">Add to basket ‚ûï</button>
          <button id="growGardenBtn">Grow garden üåø</button>
          <button id="clearGardenBtn">Clear garden</button>
          <button id="randomPaletteBtn">Random pink/purple</button>
        </div>

        <div class="field">
          <label>basket</label>
          <div id="basketList"></div>
          <div class="garden-hint">tip: add multiple types + colors. tap the garden to plant a random basket flower.</div>
        </div>

        <div class="garden-controls">
          <div class="field">
            <label for="growCount">how many to grow</label>
            <input id="growCount" type="number" min="1" max="160" value="35" />
          </div>

          <div class="field">
            <label for="scatter">scatter</label>
            <input id="scatter" type="range" min="0" max="100" value="100" />
          </div>

          <div class="field">
            <label>garden status</label>
            <div id="gardenStatus" style="font-weight:800; opacity:0.95;">empty</div>
          </div>
        </div>

        <div id="gardenCanvas" aria-label="Garden canvas"></div>

        <div class="garden-hint">
          ‚Ä¢ add items to the basket, then grow üå∑<br />
          ‚Ä¢ click/tap the garden to plant one random basket flower<br />
          ‚Ä¢ this garden is for ghala üíú
        </div>
      </div>
    </div>
  </div>

  <!-- Mini Game -->
  <div class="section">
    <h2>mini game üíó</h2>

    <div class="game-wrap">
      <div class="game-top">
        <div class="pill">score: <span id="score">0</span></div>
        <div class="pill">time: <span id="timeLeft">20</span>s</div>
        <button id="startGameBtn">Start üíò</button>
      </div>

      <div id="gameArea" aria-label="Heart catch game"></div>

      <p id="gameResult" class="hidden"></p>
    </div>
  </div>

  <script>
    // ---- Loader mini-game (runs first) ----
    const loader = document.getElementById("loader");
    const loaderHeart = document.getElementById("loaderHeart");
    const tapCountEl = document.getElementById("tapCount");

    let taps = 0;
    if (loaderHeart) {
      const tap = () => {
        taps++;
        if (tapCountEl) tapCountEl.textContent = String(taps);
        loaderHeart.style.transform = `scale(${1 + Math.min(taps, 15) * 0.02})`;
      };
      loaderHeart.addEventListener("click", tap);
      loaderHeart.addEventListener("touchstart", (e) => {
        e.preventDefault();
        tap();
      }, { passive: false });
    }

    // hide loader ASAP (don‚Äôt wait for images/music)
    window.addEventListener("DOMContentLoaded", () => {
      if (!loader) return;
      loader.classList.add("hide");
      setTimeout(() => loader.remove(), 450);
    });

    // failsafe so it NEVER gets stuck
    setTimeout(() => {
      if (!loader) return;
      loader.classList.add("hide");
      setTimeout(() => loader.remove(), 450);
    }, 2500);

    // ---- Debug (remove later) ----
    const debugBadge = document.getElementById("debugBadge");
    function setDebug(text){ if (debugBadge) debugBadge.textContent = text; }
    setDebug("js: running ‚úÖ");
    window.addEventListener("error", (e) => setDebug("js error: " + (e?.message || "unknown")));
    window.addEventListener("unhandledrejection", (e) => {
      const msg = (e?.reason && (e.reason.message || String(e.reason))) || "promise rejected";
      setDebug("js error: " + msg);
    });

    // ---- Music ----
    const bgMusic = document.getElementById("bgMusic");
    const musicBtn = document.getElementById("musicBtn");

    function tryPlayMusic() {
      if (!bgMusic) return;
      bgMusic.volume = 0.6;
      const p = bgMusic.play();
      if (p && typeof p.then === "function") p.then(() => {}).catch(() => {});
    }

    if (musicBtn && bgMusic) {
      musicBtn.addEventListener("click", () => {
        if (bgMusic.paused) tryPlayMusic();
        else bgMusic.pause();
      });
    }

    // ---- Photo enlarge ----
    const popup = document.getElementById("photoPopup");
    const popupImg = document.getElementById("popupImg");
    const popupCaption = document.getElementById("popupCaption");
    const bubbleImgs = document.querySelectorAll(".bubble img");

    bubbleImgs.forEach((img) => {
      const open = (e) => {
        e?.preventDefault?.();
        popupImg.src = img.src;
        popupImg.alt = img.alt || "";
        popupCaption.textContent = img.dataset.caption || "";
        popup.classList.add("active");
        popup.setAttribute("aria-hidden", "false");
      };
      img.addEventListener("click", open);
      img.addEventListener("touchstart", open, { passive: false });
    });

    if (popup) {
      popup.addEventListener("click", (e) => {
        if (e.target === popup) {
          popup.classList.remove("active");
          popup.setAttribute("aria-hidden", "true");
        }
      });
    }

    // ---- Yes / No ----
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const answer = document.getElementById("answer");

    if (yesBtn) {
      yesBtn.addEventListener("click", () => {
        answer?.classList.remove("hidden");
        tryPlayMusic();
      });
    }

    if (noBtn) {
      let dodges = 0;
      const dodge = () => {
        dodges++;
        if (dodges >= 4) {
          noBtn.textContent = "fine YES üò≠";
          noBtn.style.transform = "translate(0px, 0px)";
          return;
        }
        const x = Math.random() * 200 - 100;
        const y = Math.random() * 200 - 100;
        noBtn.style.transform = `translate(${x}px, ${y}px)`;
      };

      noBtn.addEventListener("mouseenter", dodge);
      noBtn.addEventListener("touchstart", (e) => { e.preventDefault(); dodge(); }, { passive: false });

      noBtn.addEventListener("click", () => {
        if (noBtn.textContent.includes("YES")) {
          answer?.classList.remove("hidden");
          tryPlayMusic();
        }
      });
    }

    // ---- Garden builder (basket) ----
    const gardenCanvas = document.getElementById("gardenCanvas");
    const basketFlowerTypeEl = document.getElementById("basketFlowerType");
    const basketFlowerColorEl = document.getElementById("basketFlowerColor");
    const basketFlowerSizeEl = document.getElementById("basketFlowerSize");
    const basketSizeReadoutEl = document.getElementById("basketSizeReadout");

    const addToBasketBtn = document.getElementById("addToBasketBtn");
    const growGardenBtn = document.getElementById("growGardenBtn");
    const clearGardenBtn = document.getElementById("clearGardenBtn");
    const randomPaletteBtn = document.getElementById("randomPaletteBtn");

    const basketListEl = document.getElementById("basketList");
    const growCountEl = document.getElementById("growCount");
    const scatterEl = document.getElementById("scatter");
    const gardenStatusEl = document.getElementById("gardenStatus");

    const basket = [];

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }
    function setGardenStatus(text){ if (gardenStatusEl) gardenStatusEl.textContent = text; }

    function flowerSVG(type, color) {
      if (type === "tulip") {
        return `
          <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M32 60c8 0 14-6 14-14V30c0-1-1-2-2-2-5 0-8 4-12 4s-7-4-12-4c-1 0-2 1-2 2v16c0 8 6 14 14 14z" fill="${color}"/>
            <path d="M32 60c-2 0-3-2-3-4V28h6v28c0 2-1 4-3 4z" fill="rgba(255,255,255,0.35)"/>
            <path d="M19 46c4 1 8-1 10-4-4 0-7-2-10-6-2 4-2 9 0 10z" fill="rgba(60,200,120,0.55)"/>
            <path d="M45 46c-4 1-8-1-10-4 4 0 7-2 10-6 2 4 2 9 0 10z" fill="rgba(60,200,120,0.55)"/>
          </svg>`;
      }
      if (type === "rose") {
        return `
          <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M32 54c10 0 18-8 18-18S42 18 32 18 14 26 14 36s8 18 18 18z" fill="${color}"/>
            <path d="M22 34c5-6 15-6 20 0-2 8-7 12-10 12s-8-4-10-12z" fill="rgba(255,255,255,0.18)"/>
            <path d="M32 60c-2 0-3-2-3-4V40h6v16c0 2-1 4-3 4z" fill="rgba(255,255,255,0.35)"/>
            <path d="M18 46c4 2 9 0 12-4-5 0-9-3-12-8-2 4-2 10 0 12z" fill="rgba(60,200,120,0.55)"/>
            <path d="M46 46c-4 2-9 0-12-4 5 0 9-3 12-8 2 4 2 10 0 12z" fill="rgba(60,200,120,0.55)"/>
          </svg>`;
      }
      return `
        <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <g fill="rgba(255,255,255,0.92)">
            <ellipse cx="32" cy="14" rx="8" ry="12"/>
            <ellipse cx="47" cy="18" rx="8" ry="12" transform="rotate(35 47 18)"/>
            <ellipse cx="54" cy="32" rx="8" ry="12" transform="rotate(90 54 32)"/>
            <ellipse cx="47" cy="46" rx="8" ry="12" transform="rotate(145 47 46)"/>
            <ellipse cx="32" cy="50" rx="8" ry="12"/>
            <ellipse cx="17" cy="46" rx="8" ry="12" transform="rotate(35 17 46)"/>
            <ellipse cx="10" cy="32" rx="8" ry="12" transform="rotate(90 10 32)"/>
            <ellipse cx="17" cy="18" rx="8" ry="12" transform="rotate(145 17 18)"/>
          </g>
          <circle cx="32" cy="32" r="10" fill="${color}"/>
          <path d="M32 60c-2 0-3-2-3-4V40h6v16c0 2-1 4-3 4z" fill="rgba(255,255,255,0.35)"/>
          <path d="M20 46c4 2 8 1 10-2-4 0-7-2-10-6-2 4-2 7 0 8z" fill="rgba(60,200,120,0.55)"/>
          <path d="M44 46c-4 2-8 1-10-2 4 0 7-2 10-6 2 4 2 7 0 8z" fill="rgba(60,200,120,0.55)"/>
        </svg>`;
    }

    function renderBasket() {
      if (!basketListEl) return;
      basketListEl.innerHTML = "";

      if (basket.length === 0) {
        basketListEl.innerHTML = "<div style='opacity:0.85;'>no flowers yet‚Ä¶ add some üíú</div>";
        setGardenStatus("empty");
        return;
      }

      setGardenStatus(`${basket.length} in basket`);

      basket.forEach((item, idx) => {
        const row = document.createElement("div");
        row.className = "pill-mini";

        const dot = document.createElement("span");
        dot.className = "dot";
        dot.style.background = item.color;

        const text = document.createElement("span");
        text.textContent = `${item.type} ‚Ä¢ ${item.size}px`;

        const del = document.createElement("button");
        del.className = "xbtn";
        del.type = "button";
        del.textContent = "√ó";
        del.addEventListener("click", () => {
          basket.splice(idx, 1);
          renderBasket();
        });

        row.appendChild(dot);
        row.appendChild(text);
        row.appendChild(del);
        basketListEl.appendChild(row);
      });
    }

    if (basketSizeReadoutEl && basketFlowerSizeEl) {
      basketSizeReadoutEl.textContent = String(basketFlowerSizeEl.value);
      basketFlowerSizeEl.addEventListener("input", () => {
        basketSizeReadoutEl.textContent = String(basketFlowerSizeEl.value);
      });
    }

    function plantFlowerAt(clientX, clientY, item) {
      if (!gardenCanvas) return;
      const rect = gardenCanvas.getBoundingClientRect();
      const x = clamp(clientX - rect.left, 10, rect.width - 10);
      const y = clamp(clientY - rect.top, 18, rect.height - 18);

      const el = document.createElement("div");
      el.className = "flower";
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      el.style.width = `${item.size}px`;
      el.style.height = `${item.size}px`;
      el.style.transform = `translate(-50%, -50%) rotate(${Math.floor(Math.random() * 40 - 20)}deg)`;
      el.innerHTML = flowerSVG(item.type, item.color);

      gardenCanvas.appendChild(el);
    }

    function clearGarden() {
      if (!gardenCanvas) return;
      gardenCanvas.innerHTML = "";
      setGardenStatus(basket.length ? `${basket.length} in basket` : "empty");
    }

    function growGarden() {
      if (!gardenCanvas) return;
      if (basket.length === 0) {
        alert("add some flowers to the basket first üíú");
        return;
      }

      const rect = gardenCanvas.getBoundingClientRect();
      const count = clamp(Number(growCountEl?.value || 35), 1, 160);
      const scatter = clamp(Number(scatterEl?.value || 100), 0, 100) / 100;

      for (let i = 0; i < count; i++) {
        const item = basket[Math.floor(Math.random() * basket.length)];
        const x = rect.left + (Math.random() * rect.width * scatter + rect.width * (1 - scatter) * 0.5);
        const y = rect.top + (Math.random() * rect.height * scatter + rect.height * (1 - scatter) * 0.5);
        plantFlowerAt(x, y, item);
      }

      setGardenStatus(`grown: ${count}`);
    }

    function randomPinkPurple() {
      const palette = ["#ff66cc", "#ec4899", "#c084fc", "#a855f7", "#7c3aed", "#f472b6"];
      if (basketFlowerColorEl) basketFlowerColorEl.value = palette[Math.floor(Math.random() * palette.length)];
    }

    if (addToBasketBtn) {
      addToBasketBtn.addEventListener("click", () => {
        const item = {
          type: basketFlowerTypeEl?.value || "daisy",
          color: basketFlowerColorEl?.value || "#ff66cc",
          size: Number(basketFlowerSizeEl?.value || 64)
        };
        basket.push(item);
        renderBasket();
      });
    }

    if (growGardenBtn) growGardenBtn.addEventListener("click", growGarden);
    if (clearGardenBtn) clearGardenBtn.addEventListener("click", clearGarden);
    if (randomPaletteBtn) randomPaletteBtn.addEventListener("click", randomPinkPurple);

    if (gardenCanvas) {
      gardenCanvas.addEventListener("click", (e) => {
        if (basket.length === 0) {
          alert("add flowers to the basket first üíú");
          return;
        }
        const item = basket[Math.floor(Math.random() * basket.length)];
        plantFlowerAt(e.clientX, e.clientY, item);
      });

      gardenCanvas.addEventListener("touchstart", (e) => {
        const t = e.touches && e.touches[0];
        if (!t) return;
        e.preventDefault();
        if (basket.length === 0) {
          alert("add flowers to the basket first üíú");
          return;
        }
        const item = basket[Math.floor(Math.random() * basket.length)];
        plantFlowerAt(t.clientX, t.clientY, item);
      }, { passive: false });
    }

    renderBasket();

    // ---- Mini game ----
    const messages = {
      low: "AHAHAHAHAHA its okay ur still the best ily",
      mid: "OKAY I SEE YOU GOOD JOB BABY",
      high: "WTF UR SO GOOD HOWWWW",
      ultra: "touch grass bud"
    };

    const gameArea = document.getElementById("gameArea");
    const startBtn = document.getElementById("startGameBtn");
    const scoreEl = document.getElementById("score");
    const timeEl = document.getElementById("timeLeft");
    const resultEl = document.getElementById("gameResult");

    const GAME_SECONDS = 20;
    const SPAWN_MS = 300;

    let score = 0;
    let time = GAME_SECONDS;
    let running = false;

    let spawnInterval = null;
    let clockInterval = null;

    function spawnHeart() {
      if (!running || !gameArea) return;
      const heart = document.createElement("div");
      heart.className = "target";
      heart.textContent = "üíó";
      heart.style.left = Math.random() * 90 + "%";
      heart.style.top = Math.random() * 80 + "%";

      const pop = (e) => {
        e?.preventDefault?.();
        if (!running) return;
        score++;
        if (scoreEl) scoreEl.textContent = String(score);
        heart.remove();
      };

      heart.addEventListener("click", pop, { passive: false });
      heart.addEventListener("touchstart", pop, { passive: false });

      gameArea.appendChild(heart);
      setTimeout(() => heart.remove(), 900);
    }

    function endGame() {
      running = false;
      if (spawnInterval) clearInterval(spawnInterval);
      if (clockInterval) clearInterval(clockInterval);
      spawnInterval = null;
      clockInterval = null;

      if (!resultEl) return;

      if (score >= 70) resultEl.textContent = messages.ultra;
      else if (score >= 50) resultEl.textContent = messages.high;
      else if (score >= 10 && score < 30) resultEl.textContent = messages.mid;
      else resultEl.textContent = messages.low;

      resultEl.classList.remove("hidden");

      // secret bonus ending for 30+
      if (score >= 30) {
        setTimeout(() => {
          alert("bonus unlocked ‚ú®\n\nyou found the hidden ending!! i love you forever ghala üíú");
        }, 400);
      }
    }

    function startGame() {
      score = 0;
      time = GAME_SECONDS;
      running = true;

      if (scoreEl) scoreEl.textContent = "0";
      if (timeEl) timeEl.textContent = String(time);
      if (resultEl) resultEl.classList.add("hidden");
      if (gameArea) gameArea.innerHTML = "";

      if (spawnInterval) clearInterval(spawnInterval);
      if (clockInterval) clearInterval(clockInterval);

      spawnInterval = setInterval(() => {
        if (!running) return;
        spawnHeart();
      }, SPAWN_MS);

      clockInterval = setInterval(() => {
        if (!running) return;
        time--;
        if (timeEl) timeEl.textContent = String(time);
        if (time <= 0) endGame();
      }, 1000);
    }

    if (startBtn) startBtn.addEventListener("click", () => {
      if (running) return;
      startGame();
    });

    // ---- Secrets ----
    const bigHeart = document.getElementById("bigHeart");
    let heartTaps = 0;

    function heartTap() {
      heartTaps++;
      if (heartTaps === 5) {
        alert("secret message üíú\n\ni love you more than words can explain!!");
      }
    }

    if (bigHeart) {
      bigHeart.addEventListener("click", heartTap);
      bigHeart.addEventListener("touchstart", (e) => { e.preventDefault(); heartTap(); }, { passive: false });
    }

    // Secret: press G for purple heart rain
    document.addEventListener("keydown", (e) => {
      if (String(e.key || "").toLowerCase() === "g") {
        for (let i = 0; i < 20; i++) {
          const rain = document.createElement("div");
          rain.textContent = "üíú";
          rain.style.position = "fixed";
          rain.style.left = Math.random() * 100 + "vw";
          rain.style.top = "-20px";
          rain.style.fontSize = "24px";
          rain.style.pointerEvents = "none";
          rain.style.transition = "transform 1.5s linear";

          document.body.appendChild(rain);

          setTimeout(() => { rain.style.transform = "translateY(110vh)"; }, 10);
          setTimeout(() => rain.remove(), 1600);
        }
      }
    });
  </script>
</body>
</html>
